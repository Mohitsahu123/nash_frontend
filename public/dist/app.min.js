
var psApp=angular.module('myApp',['ui.router','ngCookies','ngProgressLite','cgNotify','LocalStorageModule','ngAnimate']);

psApp.config(['$stateProvider', '$urlRouterProvider','$httpProvider', function($stateProvider, $urlRouterProvider, $httpProvider) {
    $urlRouterProvider.otherwise('/');
    $stateProvider
       
        .state('home',{
            url:'/dashboard',
            templateUrl:'home.html'
        })
        .state('/', {
            url: '/',
            controller: 'indexController'
        })
       
        .state('dynstate',{
            url : '/{id}?{locale}&{survey_id}',
            templateUrl: function (stateParams){
                return   stateParams.id + '.html';
            }
        })
        .state('404',{
            url : '/404',
            templateUrl: '404.html'
        })
        
        
}]);


psApp.run(['$rootScope','$location','$state','$window','$cookies', 'notify',  '$timeout', function($rootScope, $location, $state, $window,  $cookies, notify, $timeout) {
    $rootScope.$on("$stateChangeStart", function(event, toState, toParams, fromState, fromParams) {
        
        $rootScope.$state = $state;
        if (toState != null && toState.access != null ) {
            event.preventDefault();
            $state.go("login");
        }
        if(toState != null &&  toState.url!=null && (toState.url=='/' || toState.url=='') ) {
            event.preventDefault();
            $state.go("home");

        }
        if(toState.url=="/login"){
            $window.location.href="/#/";
        }

       
       
    });

}]);







angular.module('myApp')
    .factory('scrapperService',['$http','config', function($http, config) {
        var base_url = 'http://localhost:3000/scrapper';
        return {
            getImagesByKeyword: function (keyword) {
                return $http.get(base_url + '/getKeyword/'+keyword);
            },

            listKeyword : function(){
                return $http.get(base_url + '/listKeyword');
            },

            saveImagesByKeyword : function(keyword){
                return $http.post(base_url, keyword);
            }
        }
    }]);

angular.module('myApp')
.controller('dashCtrl',['$scope','$http','$state', 'notify', 'ngProgressLite',  '$rootScope','$stateParams', 
  'scrapperService', function($scope, $http, $state,  notify,  ngProgressLite,  $rootScope , $stateParams, scrapperService){

    $scope.dashObj ={};
      
    $scope.saveImagesByKeyword = function (keyword) {
        ngProgressLite.start();
       
        scrapperService.saveImagesByKeyword($scope.dashObj).success(function (data) {
            ngProgressLite.done();
            notify({message:data.msg,classes:'alert-success',duration:3000} );
        }).error(function (err) {
            notify({message:err.msg,classes:'alert-danger',duration:3000} );
        })
    }

}]);


angular.module('myApp')
    .controller('indexController',['$scope','$http','$state','$cookies','$window','config',function($scope, $http, $state, $cookies ,$window, config){

    }]);
angular.module('myApp')

    .controller('mainCtrl',['$scope','localStorageService' ,'$state' ,'$rootScope',function($scope, localStorageService ,$state ,$rootScope){
        $scope.app = {
            name: 'myApp',
            version: '1.0.0'
           
        };
        $scope.$state = $state;

        $rootScope.$on('$stateChangeStart',
            function(event, toState, toParams, fromState, fromParams, options){
               if( toState.name == 'home'){
                   $scope.fotrHide = true;
                   $scope.hdrHide = true;
               }
               else{
                   $scope.fotrHide = false;
                   $scope.hdrHide = false;

               }
            }
        );

    }]);

angular.module('myApp')
    .controller('scrapperCntrl',['$scope','$http','$state','notify','ngProgressLite', 'scrapperService',function($scope, $http, $state, notify,  ngProgressLite, scrapperService){
         listKeyword();
         $scope.apiBaseUrl = "http://localhost:3000/"
          function listKeyword(){
            ngProgressLite.start();
            scrapperService.listKeyword().success(function (data) {
                ngProgressLite.done();
                $scope.keywords=data;
            }).error(function (err) {
                notify({message:err.msg,classes:'alert-danger',duration:3000} );
            })
        }

       
          $scope.getImagesByKeyword = function (keyword) {
            ngProgressLite.start();
            scrapperService.getImagesByKeyword(keyword.keyword).success(function (data) {
                ngProgressLite.done();
                $scope.imagesArr=data.images_path;
            }).error(function (err) {
                notify({message:err.msg,classes:'alert-danger',duration:3000} );
            })
        
        }

      
    }]);